<script th:inline="javascript">
    var stories = /*[[${stories}]]*/[];

    //====================================DRAGGING AND DROPPING STORIES IN APPRECIATE COLUMN=============================================
    /*Script for drag animation*/
    $(function () {

        $(".draggable").ready().draggable({
            containment: "#droppable",
            revert: "invalid",
            stack: ".draggable",
            drag: function (event, ui) {
                ui.helper.css({
                    transform: "rotate(6deg)"
                });
            }
        });
    });

    $(".droppable").droppable({
        drop: function (event, ui) {

            /*Appending dragged div to droppable div*/
            $(this)
                .append(ui.helper.css({
                    position: 'relative',
                    left: '0px',
                    top: '0px',
                    transform: "rotate(0deg)"
                }));

           // var stories = updateStatusOfAllStories();
            updateStatusOfAllStories();
            sendStoriesToServer(stories);
        }
    });

    /*Updating status of stories and sending result*/
    function updateStatusOfAllStories() {
        /*<![CDATA[*/
         //   var stories = /*[[${stories}]]*/[];

            for (var i = 0; i < stories.length; i++) {

                var story = document.getElementById(stories[i].id);
                var status = story.parentElement.id.toUpperCase();

                stories[i].status.name = status;
            }
        /*]]>*/
    }

    function sendStoriesToServer(stories) {
        stories = JSON.stringify({
            'stories': stories
        });

        $.ajax({
            url: "http://localhost:8080/updateStories",
            type: 'POST',
            data: stories,
            dataType: "html",
            contentType: 'application/json',
            mimeType: 'application/json',
            success: function (data) {
                console.log(data);
                return false;
            }
        });
    }

    //====================================ASSIGNING USER TO STORY (BY PRESSING BUTTON)=============================================
    /*when user click the button 'Assign story' then send project id*/
    $(document).ready(function () {
        $(".assignStoryButton").click(function () {
                var storyId = $(this)
                    .parent()
                    .parent()
                    .attr('id');

                assignUserToStory(storyId);
                changeView($(this));
                updateAssignedUserId(storyId);
            }
        )
    });


    /*send assigned story id to server*/
    function assignUserToStory(storyId) {
        $.ajax({
            url: "http://localhost:8080/assignUserToStory?storyId=" + storyId,
            type: 'POST'
        });
    }

    /*Replace button 'Assign story' with assigned user details*/
    function changeView(assignStoryButton) {
        /*<![CDATA[*/
            var assignedUser = [[${assignedUser}]];
            var userDetails = assignedUser.firstName + " " + assignedUser.lastName;
            assignStoryButton.replaceWith("<h6 class='text-white text-center'>" + userDetails + "</h6>");
        /*]]>*/
    }

    function updateAssignedUserId(storyId) {
        /*<![CDATA[*/
            var assignedUser = [[${assignedUser}]];

            for (var i = 0; i < stories.length; i++) {
                if (Number(stories[i].id) === Number(storyId)) {
                    stories[i].assignedUserId = assignedUser.id;
                }
            }
        /*]]>*/
    }


</script>
